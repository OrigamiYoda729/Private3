function Tab(n,t,i,r){this.parent=n;this.element=t;this.data=r;this.isActive=!1;this.isHover=!1;this.isHomebound=!1;this.isClose=!1;this.className=null;t.className="tabbar-tab";t.title=i;Event.addListener(t,"mouseover",this.onMouseOver,this);Event.addListener(t,"mouseout",this.onMouseOut,this);Event.addListener(t,"click",this.onClick,this);var u=document.createElement("A");u.href="tab:"+i;u.innerHTML=i;u.onclick=Function.falseFunction;t.appendChild(u)}function RestoreTab(n,t){var i,r;this.parent=n;this.element=t;t.className="tabbar-tab tabbar-restore";t.title="Add Gradebook to tabs";t.id="restoreTab";Event.addListener(t,"click",this.onClick,this);i=document.createElement("A");i.href="tab:restore";i.innerHTML='<i class="fa fa-fw fa-plus"><\/i>';i.onclick=Function.falseFunction;t.appendChild(i);r=document.createElement("div");r.id="restoreTabs";r.className="popup collapse";Element.insertAfter(r,$(this.parent.id))}function TabBar(n){this.id=n;this.tabs=[];Event.addListener(window,"unload",this.dispose,this)}Tab.prototype.dispose=function(){Event.removeListener(this.element,"mouseover",this.onMouseOver,this);Event.removeListener(this.element,"mouseout",this.onMouseOut,this);Event.removeListener(this.element,"click",this.onClick,this);this.parent=null;this.element=null;this.data=null};Tab.prototype.onMouseOver=function(){this.isActive||(this.isHover=!0,this._updateClassName())};Tab.prototype.onMouseOut=function(){this.isHover&&(this.isHover=!1);this._updateClassName()};Tab.prototype.onClick=function(n){if(this.isClose&&n.target.className=="tab-close"){this.closeTab(this);return}if(!this.isActive){var t=this.parent.getActiveTab();this.parent.onSelected(this,t)!==!1&&(t.setActive(!1),this.setActive(!0))}};Tab.prototype.onCloseTab=function(n){var t=new Json.Request(GRADEBOOKSERVICE_URL,"HideGradebook");t.invoke({gradebookId:n.data})};Tab.prototype.closeTab=function(n){if(this.isActive){var t=this.parent.getNextTab();if(t==null)return;this.parent.onSelected(t,n)!==!1&&(this.setActive(!1),t.setActive(!0))}if(this.isClose){this.parent.removeTab(n);this.onCloseTab(n);Element.hide(n.element)}};Tab.prototype.setActive=function(n){n&&(this.isHover=!1);this.isActive=n;this._updateClassName()};Tab.prototype._updateClassName=function(){var n=["tabbar-tab"];this.isClose&&n.push("tabbar-close");this.isHover&&n.push("tabbar-hover");this.isActive&&n.push("tabbar-active");this.isHomebound&&n.push("tabbar-homebound");this.className&&(this.className=="tabbar-homeboundlock"&&n[n.length-1]=="tabbar-homebound"&&n.pop(),n.push(this.className));this.element.className=n.join(" ")};Tab.prototype.setClassName=function(n){this.className=n;this._updateClassName()};Tab.prototype.setClose=function(n){if(this.isClose=n,n){var t=document.createElement("span");t.className="tab-close";this.element.appendChild(t)}};RestoreTab.prototype.dispose=function(){Event.removeListener(this.element,"click",this.onClick,this);this.parent=null;this.element=null};RestoreTab.prototype.getGradebooksToRestore=function(){var n=new Json.Request(GRADEBOOKSERVICE_URL,"GetHiddenGradebooks");return n.invoke()};RestoreTab.prototype.onRestoreTab=function(n){var t=new Json.Request(GRADEBOOKSERVICE_URL,"ShowGradebook");t.invoke({gradebooks:n});window.location.reload()};RestoreTab.prototype.onListHeader=function(){var n=document.createElement("li");return n.innerHTML="No hidden gradebooks found",n};RestoreTab.prototype.onClick=function(n){n.preventDefault();n.stopPropagation();var i=this.getGradebooksToRestore(),r=this,t=new CheckboxPopup($("restoreTabs"));t.setApplyText("Add to tabs");t.onListHeader=this.onListHeader;t.load(i);t.onApply=this.onRestoreTab;t.show(r.element,n)};RestoreTab.prototype.setClassName=Function.empty;TabBar.prototype.dispose=function(){Event.removeListener(window,"unload",this.dispose,this);this.tabs.dispose();this.tabs.clear();this.tabs=null};TabBar.prototype.removeTab=function(n){this.tabs.remove(n)};TabBar.prototype.canClose=function(n){var i,r,t;for(this.canClose=n,i=0;i<this.tabs.length;i++)t=this.tabs[i],t.setClose(this.canClose),t.setClassName();r=this.getTable();t=document.createElement("li");r.appendChild(t);this.tabs.push(new RestoreTab(this,t))};TabBar.prototype.clear=function(){var n=this.getTable();n.innerHTML="";this.tabs.dispose();this.tabs.clear()};TabBar.prototype.getFrame=function(){return $(this.id)};TabBar.prototype.getTable=function(){return $(this.id+"_t")};TabBar.prototype.add=function(n,t){var r=this.getTable(),i=document.createElement("li");r.appendChild(i);this.tabs.push(new Tab(this,i,n,t));this.tabs.length==1&&this.tabs[0].setActive(!0)};TabBar.prototype.getActiveTab=function(){for(var n=0;n<this.tabs.length;n++)if(this.tabs[n].isActive)return this.tabs[n];return null};TabBar.prototype.getNextTab=function(){return this.tabs.length<=2?null:this.tabs[0].isActive?this.tabs[1]:this.tabs[0]};TabBar.prototype.setActiveTab=function(n){if(this.tabs[n]){var t=this.getActiveTab();t&&t.setActive(!1);this.tabs[n].setActive(!0)}};TabBar.prototype.setHomeboundClass=function(n){this.tabs[n]&&(this.tabs[n].isHomebound=!0,this.tabs[n]._updateClassName())};TabBar.prototype.onSelected=function(){return!0};