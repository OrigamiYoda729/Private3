function unescapeHTML(n){var t=document.createElement("div");return t.innerHTML=n,Browser.type===BrowserType.IE?t.innerText:t.textContent}var INTERNETVIEWER_SERVICE_URL="InternetViewerService.ashx",CrystalRequestStatus={Created:"Created",Pending:"Pending",Running:"Running",Ready:"Ready",Failed:"Failed"},CLASSDETAILS_URL;Piv={};Piv.classes=[];Piv.LOADING_IMAGE="<img src='Images/loading.gif' alt='Loading' style='position:absolute;top:50%;left:50%;margin-left:-100px;margin-top:-24px;'/>";Piv.getStudentId=function(){return $("uxStudentId",PageIdPrefix).value};Piv.getQueryString=function(){var n="";return n+="?Enrollment="+$("uxClass").value,n+="&Term="+$("uxTerm").value,n+="&ReportType="+$("uxReport").selectedIndex,n+("&Student="+Piv.getStudentId())};Piv.requestCrystalReport=function(n){Piv._crystalReport=new Piv.CrystalReport;Piv._crystalReport.aquire(n,0,0)};Piv.requestCrystalReportForStudent=function(n,t){Piv._crystalReport=new Piv.CrystalReport;Piv._crystalReport.acquireForStudent(n,t)};Piv.loadReportFrame=function(n){$("Content",PageContentIdPrefix).src="about:blank";window.open(n,"_blank")};Piv.loadWindow=function(n){window.location=n};Piv.loadReport=function(n){Piv._crystalReport!=null&&Piv._crystalReport.cancel();n.isCrystal?Piv.requestCrystalReport(n.id):Piv.loadWindow(n.id+Piv.getQueryString())};Piv.linkReport_onClick=function(n){n.preventDefault();Piv.loadReport(this.report)};Piv.renderClassReport=function(n){var t=SelectElement.add($("uxReport"),n.title,n.id);t.report=n};Piv.renderClassIndependantReport=function(n){var i=document.createElement("li"),t=document.createElement("a");t.report=n;t.href="#";Element.setInnerText(t,n.title);Event.addListener(t,"click",Piv.linkReport_onClick,t);i.appendChild(t);$("uxClassIndependantReports").appendChild(i)};Piv.clearTerms=function(){for(var n=$("uxTerm");n.options.length>0;)n.remove(0)};Piv._loadTerms=function(){var i,u,n,t;Piv.clearTerms();var r=$("uxTerm"),e=$("uxClass").value,o=new Date,arguments=QueryString.parse(window.location.search),f=arguments.TermId;for(i=0;i<Piv.classes.length;i++)if(Piv.classes[i].classId==e){for(u=Piv.classes[i].terms,n=0;n<u.length;n++)(t=u[n],t.showInViewer)&&(SelectElement.add(r,t.description,t.termId),f==null&&new Date(t.start)<=o?r.selectedIndex=n:f==t.termId&&(r.selectedIndex=n));break}};Piv.resetNavigationMenu=function(){for(var i=$("uxClass"),n,t;i.options.length>0;)Element.remove(i.options[0]);for(n=$("uxTerm");n.options.length>0;)Element.remove(n.options[0]);for(t=$("uxReport");t.options.length>0;)Element.remove(t.options[0]);$("uxClassIndependantReports").innerHTML=""};Piv._DropDownHasValue=function(n,t){for(var u,r=n.options,i=0,f=r.length;i<f;i++)if(u=r[i],u.value==t)return!0;return!1};Piv._setReportValues=function(n){var arguments=QueryString.parse(n),r=arguments.EnrollmentId,t,i,u;r&&Piv._DropDownHasValue($("uxClass"),r)&&($("uxClass").value=r);t=arguments.TermId;t&&Piv._DropDownHasValue($("uxTerm"),t)&&($("uxTerm").value=t);i=arguments.ReportType;u=$("uxReport").options;i>=0&&i<=u.length-1&&($("uxReport").selectedIndex=i)};Piv.load=function(n){var i,f,t,e,o;if(Piv.resetNavigationMenu(),i=Piv.getStudentId(),i){var s=new Json.Request(INTERNETVIEWER_SERVICE_URL,"Init"),r=s.invokeAndCache("InternetViewerHomePage_"+i,{studentId:i}),u=r.reports;for(r.classes.length==0&&typeof courseRequestFrameId=="undefined"&&($("Content").innerHTML='<div class="nostudent"><center>This student does not have any classes.<\/center><\/div>',f=$("printButton"),f&&(f.style.display="none")),Piv.gradeSummaryEnabled=r.gradeSummaryEnabled,t=0;t<u.length;t++)u[t].isClassDependant?Piv.renderClassReport(u[t]):Piv.renderClassIndependantReport(u[t]);for(Piv.classes=r.classes,t=0;t<Piv.classes.length;t++)Piv.classes[t].terms.length>0&&SelectElement.add($("uxClass"),Piv.classes[t].title,Piv.classes[t].classId);n&&(Piv._setReportValues(n),t=n.indexOf("target="),t==1&&(e=n.indexOf("&"),o=n.substr(8,e-8)+".aspx?",Piv.loadReportFrame(o+n.substr(e))));Piv._loadTerms()}};Piv.loadByStudent=function(n,t,i){Event.normalize(t);t.preventDefault();$(PageIdPrefix+"uxStudentId").value=i;location.href="Default.aspx?StudentId="+i};Piv.uxUpdate_onClick=function(n,t){var r,u,i,f;(Event.normalize(t),t.preventDefault(),r=$("uxClass"),r.selectedIndex!=-1)&&(u=$("uxTerm"),u.selectedIndex!=-1)&&(i=$("uxReport"),i.options.length!=0)&&(f=i.options[i.selectedIndex],Piv.loadReport(f.report))};Piv.uxClass_onChange=function(){Piv._loadTerms();new Effect.yellowFade($("uxTerm"))};Piv.uxPrint_onClick=function(n,t){var r,i;if(Event.normalize(t),t.preventDefault(),r=$("Content"),r.children.length==1&&(i=r.children[0],i.tagName.toUpperCase()=="IFRAME")){i.contentWindow.focus();i.contentWindow.print();return}Piv.print()};Piv.uxEmail_onClick=function(n,t){Event.normalize(t);t.preventDefault();Piv.loadWindow("Subscriptions.aspx"+Piv.getQueryString())};Piv.uxCourseRequest_onClick=function(n,t){Event.normalize(t);t.preventDefault();Piv.loadWindow("CourseRequest.aspx"+Piv.getQueryString())};Piv.write=function(n){$("Content",PageContentIdPrefix).src="about:blank";var t=function(){var t=$("Content",PageContentIdPrefix).contentWindow.document;t.open("text/html","replace");t.write("<!DOCTYPE html>");t.write("<html><head><title>Loading<\/title><\/head><body>");t.write(n);t.write("<\/body><\/html>");t.close()};window.setTimeout(t,50)};Piv.CrystalReport=function(){this._requestId=null;this._status=CrystalRequestStatus.Pending;this._timer=new Timer;this._canceled=!1};Piv.CrystalReport.prototype.cancel=function(){this._timer.clear();this._request.abort()};Piv.CrystalReport.prototype._checkReportStatus=function(){this._request=new Json.Request(INTERNETVIEWER_SERVICE_URL,"GetRequestStatus");this._requestId=$("uxReportRequestId",PageContentIdPrefix).value;var n=this;this._request.onSuccess=function(t){n._status=t;switch(t){case CrystalRequestStatus.Ready:Piv.loadReportFrame("../Gradebook/Reports/ReportFile.ashx?requestId="+n._requestId);break;case CrystalRequestStatus.Failed:Piv.write('<div style="position:absolute;top:50%;left:50%;width:200px;height:48px;margin-left:-100px;margin-top:-24px;text-align:center">A problem was encountered while running the report.<\/div>');break;default:n._timer.setTimeout(n._checkReportStatus.bind(n),4e3)}};this._request.invoke({requestId:this._requestId})};Piv.CrystalReport.prototype.startPolling=function(){this._timer.setTimeout(this._checkReportStatus.bind(this),1e3)};Piv.CrystalReport.prototype.aquire=function(n,t,i){var r,u,f;this._request=new Json.Request(INTERNETVIEWER_SERVICE_URL,"CreateRequest");r=this;u=Piv.getStudentId();this._request.onSuccess=function(n){r._requestId=n.requestId;r.status=CrystalRequestStatus.Pending;window.location="reportmain.aspx?student="+u+"&requestId="+r._requestId};f={reportId:n,enrollmentId:t,studentId:u,termId:i};this._request.invoke(f)};Piv.CrystalReport.prototype.acquireForStudent=function(n,t){var i,r;this._request=new Json.Request(INTERNETVIEWER_SERVICE_URL,"CreateRequest");i=this;this._request.onSuccess=function(n){i._requestId=n.requestId;i.status=CrystalRequestStatus.Pending;window.location="reportmain.aspx?student="+t+"&requestId="+i._requestId};r={reportId:n,enrollmentId:0,studentId:t,termId:0};this._request.invoke(r)};CLASSDETAILS_URL="ClassDetail.aspx";ClassDetails=new Dialog("ClassDetails");ClassDetails.getClassDetails=function(n){this._request=new Json.Request(INTERNETVIEWER_SERVICE_URL,"GetClassDetails");var t=this;this._request.onSuccess=function(n){var i=n.classDetails;$("narrative").innerHTML=unescapeHTML(i.narrative);$("description").innerHTML=i.courseDescription;Element.setInnerText($("period"),i.period);Element.setInnerText($("courseName"),i.courseName);Element.setInnerText($("teacherName"),i.teacherName);Dialog.prototype.open.call(t);$("ClassDetails").focus();jQuery("#narrative a").each(function(n,t){t.target="_blank"})};this._request.invoke({enrollmentId:n})},function(n){n(function(){n("table.row-select").on("click","tr",function(){var t=n(this).find("a");t.length>0&&(document.location.href=t[0].href)}).on("mouseover","tr",function(){n(this).addClass("hover")}).on("mouseout","tr",function(){n(this).removeClass("hover")}).on("touchstart","tr",function(){n(this).addClass("tap")}).on("touchend touchcancel","tr",function(){n(this).removeClass("tap").blur()});n("ul.mtabs li a").click(function(n){n.preventDefault();location.replace(this.href)})})}(jQuery);